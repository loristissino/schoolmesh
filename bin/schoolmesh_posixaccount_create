#!/bin/bash

CONFIG_READ=0
source /var/schoolmesh/config/schoolmesh.rc $@
if [ $CONFIG_READ -ne 1 ]; then echo "Error in reading configuration"; exit 1; fi

USERNAME=$1
GROUP=$2
FULLNAME=$3

checkDirectory "$POSIX_HOMEDIR"
checkNotUsername $USERNAME

HOMEDIR="$POSIX_HOMEDIR/$USERNAME"

checkNotFile "$HOMEDIR"
checkGroup "$GROUP"
checkString "$FULLNAME"
checkString "$POSIX_BASEFOLDER"

BASEFOLDER="$COMPLETEDIR/$POSIX_BASEFOLDER"

sudo useradd -d "$HOMEDIR" -g $GROUP -c "$FULLNAME" $USERNAME -s /bin/false && echo "added user $USERNAME" || exit 20
schoolmesh_posixaccount_createhomedir $USERNAME
schoolmesh_posixaccount_createbasefolder $USERNAME
schoolmesh_posixaccount_setquota $USERNAME $POSIX_DEFAULT_QUOTA_SBQ $POSIX_DEFAULT_QUOTA_HBQ $POSIX_DEFAULT_QUOTA_SFQ $POSIX_DEFAULT_QUOTA_HFQ
