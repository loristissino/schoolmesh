#summary Modifiche e personalizzazioni locali
#labels Phase-Deploy

= Modifiche e personalizzazioni locali =

Le più importanti modifiche riguardano le modalità di accesso al database e di autenticazione. 

I file da prendere in considerazione sono:

  * _apps/frontend/config/app.yml_ (configurazione dell'applicazione di frontend)
  * _apps/backend/config/app.yml_ (configurazione dell'applicazione di backend)
  * _config/databases.yml_ (accesso ai database)

*Attenzione*: questi file vengono sovrascritti con gli aggiornamenti, per cui è importante farsene una copia di sicurezza (ad esempio, in _/etc/schoolmesh_.

== Autenticazione ==

L'autenticazione degli utenti può avvenire secondo modalità personalizzabili.

Nei file __app.yml__ è indicata la funzione da chiamare per verificare la correttezza della coppia username/password:

{{{
  sf_guard_plugin:
    check_password_callable: [Authentication, testOnly]

# Choose one of the following functions:
# testOnly: all users are authenticated whatever password (but null) they provide
# checkDBPassoword: users are authenticated against the internal DB
# checkLdapPassword: users are authenticated against a LDAP server, specified in the lines below
# checkSambaPassword: users are authenticated against a Samba server (probably working also against a Windows authentication server)
# checkFirstSambaThenDBPassword: it they have a Samba Account, users are authenticated with that, otherwise against the DB


  authentication:
    ldap_host: localhost
    ldap_domain: dc=example,dc=com
    samba_share: //example_server/homes
    samba_address: 127.0.0.1
}}}

== Configurazione POSIX ==

Il file da modificare per la configurazione degli account POSIX è _config/schoolmesh.rc_, che nelle prime righe contiene voci come le seguenti:

{{{
# This file contains settings for schoolmesh-related shell scripts (schoolmesh_*).
# It must be sourced in order to have a common configuration.

if [ $# -eq 0 ]
	then
		echo "This script is a wrapper. See schoolmesh(1) for details."
		exit 1
	fi

CONFIG_READ=1
POSIX_HOMEDIR=/home/testhome
POSIX_HOMEDIR_USERS="$POSIX_HOMEDIR/users"
POSIX_HOMEDIR_TEAMS="$POSIX_HOMEDIR/teams"
POSIX_BASEFOLDER=Mattiussi
POSIX_BASEFOLDER_OWNER=root:root
POSIX_DEFAULT_QUOTA_SBQ=2000
POSIX_DEFAULT_QUOTA_HBQ=3000
POSIX_DEFAULT_QUOTA_SFQ=1000
POSIX_DEFAULT_QUOTA_HFQ=1500

# DO NET EDIT PASS THIS LINE
}}}

Modificare le voci come ritenuto necessario.


== Amministrazione ==

(Questo è da rivedere, qualcosa è cambiato)

Per poter fare delle operazioni relative agli utenti (verifica home directory, quote disco, ecc.) è necessario che il server web sia abilitato ad eseguire dei comandi tramite esercizio di delega (con _sudo_).

Nel file _apps/frontend/config/app.yml_ esistono due righe che indicano a SchoolMesh se si deve attendere che queste deleghe siano impostate:

{{{
  system:
    commands_view: true
    commands_apply: false
}}}

Se si imposta `commands_view` a `false` SchoolMesh non potrà fare le verifiche.

Se si imposta `commands_apply` a `false` SchoolMesh non potrà apportare le modifiche necessarie (ma genererà degli script da eseguire a parte).

Lo script di test del setup rispecchia queste impostazioni. Ad esempio, se `commands_view` è `false`:


{{{
cd /var/schoolmesh
symfony test:unit schoolmesh
....
# webserver is configured to view data: no
# webserver is configured to apply changes: no
...
 Looks like everything went fine.
}}}

== Personalizzazione del layout e dell'interfaccia generale ==

Ogni scuola può personalizzare secondo le proprie esigenze diverse cose. Alcune personalizzazioni possono essere fatte direttamente modificando i file _app.yml_:

Per l'ITC Mattiussi ci sono queste voci:

{{{
  school:
    name:           ITC Mattiussi
    town:           Pordenone
    website:        'http://www.itcmattiussi.it'

  mail:
    webmaster:      loris.tissino@mattiussilab.net
    
  config:
    current_year:   2008  # only the first of the two years of a scholastic/academic year
    culture: it
    posix_homedir: /home/testhome 
    posix_basefolder: Mattiussi  # this folder contains symbolic links and other stuff; should be present in each homedir
    teachers_default_posix_group: docenti
    students_default_posix_group: allievi
    class_teachersteam_prefix: cdc  # for the new team of teachers automatically created, and the name will be prefixed with this
    class_teachersteam_name: Consiglio di classe
    googleapps_domain: mattiussilab.net
    googleapps_url: http://webmail.mattiussilab.net
}}}

Il logo è nel file _web/images/logo.png_.

Il layout principale della pagina è nel file _apps/frontend/templates/layout_orig.php_.
Piuttosto di cambiare questo, è preferibile creare un layout diverso e far puntare il link simbolico _apps/frontend/templates/layout.php_ alla propria versione.

== Personalizzazione delle impostazioni ==

I dati principali non frequentemente modificabili sono amministrabili con l'applicazione di backend.

Vedi [Manuale Manuale d'uso]

Passo successivo: [Integrazione Integrazione con Samba, Squid, ecc.]
