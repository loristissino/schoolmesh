#summary Configurazione di Apache
#labels Phase-Deploy

= Configurazione di Apache =

Qui di seguito viene dato per scontato che la directory in cui risiede il software sia _var/schoolmesh_. Se si installa il software altrove, andranno modificate di conseguenza le istruzioni.

Inoltre, le configurazioni di Apache possono variare (ad esempio, potrebbe essere preferibile la soluzione di lasciare inalterato il file _default_, aggiungendo un server virtuale).

1. Modificare il file _/etc/apache2/sites-available/default_ aggiungendo le seguenti righe, subito prima di `</VirtualHost>`:

{{{
    Alias "/schoolmesh/sf" "/usr/share/php/data/symfony/web/sf"
    Alias /schoolmesh "/var/schoolmesh/web/"

    DirectoryIndex index.php

    <Directory "/var/schoolmesh/web">
      AllowOverride All
      Allow from All
    </Directory>

    <Directory "/usr/share/php/data/symfony/web/sf">
       AllowOverride All
       Allow from All
    </Directory>
}}}

2. Se il percorso scelto per l'applicazione non è _/schoolmesh_, modificare la riga del file _web/.htaccess_ contenente la riga relativa alla _RewriteRule_:

{{{
  RewriteRule ^(.*)$ /schoolmesh2/index.php [QSA,L]
}}} 

3. Modificare i file di configurazione di PHP (_/etc/php5/apache2/php.ini_ e _/etc/php5/cli/php.ini_) in modo che contengano le seguenti impostazioni:

{{{
short_open_tag = Off
memory_limit = 128M
}}}

Comando:

{{{
sudo gedit /etc/php5/apache2/php.ini /etc/php5/cli/php.ini
}}}

4. Riavviare il server apache.

Comando:

{{{
sudo /etc/init.d/apache2 restart
}}}

5. Modificare il file _/var/schoolmesh/apps/frontend/config/app.yml_ in modo che contenga le informazioni corrette nella sezione _config_:

{{{
  config:
    current_year:   2009  # only the first of the two years of a scholastic/academic year
    culture: it
    base_url: 'http://localhost/schoolmesh'
}}}

Comando:

{{{
sudo gedit /var/schoolmesh/apps/frontend/config/app.yml
}}}

(Notare che nell'esempio fornito c'è 2008 al posto di 2009 e https al posto di http.)

6. Configurare _sudo_ in modo che l'utente _www-data_ abbia la delega per interrogare il sistema sugli utenti e le loro directory.

Il file _/etc/sudoers_ (da modificare con `sudo visudo`, non direttamente!) dovrebbe contenere le seguenti voci:

{{{
# User alias specification
User_Alias WEBSERVER=www-data

# Cmnd alias specification
Cmnd_Alias SCHOOLMESH_INFO = /usr/bin/stat, /usr/bin/lsattr, /usr/bin/getfacl, /usr/bin/quota, /usr/bin/chage --list, /usr/bin/pdbedit -Lvu *

Cmnd_Alias SCHOOLMESH_RESETSAMBAPASSWORD = /usr/bin/smbpasswd
Cmnd_Alias SCHOOLMESH_RESETLOGINPASSWORD = /usr/sbin/chpasswd

# Cmnd_Alias SCHOOLMESH_APPLY = /usr/local/bin/schoolmesh*

# User privilege specification
root    ALL=(ALL) ALL

# Members of the admin group may gain root privileges
%admin    ALL=(ALL) ALL
WEBSERVER ALL=NOPASSWD: SCHOOLMESH_INFO, SCHOOLMESH_APPLY
}}}

Togliere il `#` sulla riga 

{{{
# Cmnd_Alias SCHOOLMESH_APPLY = /usr/local/bin/schoolmesh*
}}}

solo se si configura SchoolMesh per l'esecuzione automatica degli script di gestione di sistema (*non raccomandabile per il momento*).

7. Effettuare i test relativi alla configurazione di Apache e di SchoolMesh:

{{{
cd /var/schoolmesh
symfony test:unit schoolmesh
}}}

Si dovrebbe ottenere un risultato simile al seguente:

{{{
1..11
ok 1 - SchoolMesh seems to be installed correctly.
# webserver configuration: www-data
# webserver is configured to view data: yes
ok 2 - webserver can run /usr/bin/stat
ok 3 - webserver can run /usr/bin/lsattr
ok 4 - webserver can run /usr/bin/getfacl
ok 5 - webserver can run /usr/bin/quota
# webserver is configured to apply changes: no
# webserver is not supposed to do some things
ok 6 - webserver cannot run /sbin/poweroff
ok 7 - webserver cannot run /usr/bin/killall
# PHP configuration (cli)
ok 8 - short_open_tag is set to off
ok 9 - memory limit is ok
# PHP configuration (apache)
ok 10 - short_open_tag is set to off
ok 11 - memory limit is ok
 Looks like everything went fine.                                      
}}}



== SSL ==

(Da completare)

Abilitazione del modulo ssl di Apache:

{{{
$ sudo a2enmod ssl
Module ssl installed; run /etc/init.d/apache2 force-reload to enable.

$ sudo /etc/init.d/apache2 force-reload
 * Reloading web server config apache2                                   [ OK ] 

}}}



Passo successivo: [MySQL Configurazione di MySql]