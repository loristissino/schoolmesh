#summary Integrazione con SmoothWall
#labels Phase-Deploy

= Integrazione con SmoothWall =

Per l'abilitazione/disabilitazione dell'accesso a Internet SchoolMesh si basa su dei comandi da dare ad una macchina Linux che funziona da firewall e proxy server.

La documentazione che segue riguarda SmoothWall, ma dovrebbe essere facilmente adattabile anche ad altri tipi di distribuzioni Linux, visto che si basa su semplici comandi iptables.

== Aggiunta delle chiavi di autorizzazione ==

Fare in modo che l'utente www-data (server web sotto cui funziona l'applicazione SchoolMesh) possa eseguire i comandi dell'utente `root` della macchina SmoothWall, attraverso l'aggiunta delle chiavi di autorizzazione, agendo sul file `/root/.ssh/authorized_keys`. 

== Personalizzazione di SmoothWall ==

Creare, sulla macchina SmoothWall, due directory per contenere gli script e i file personalizzati di SchoolMesh:

{{{
mkdir /etc/schoolmesh /root/schoolmesh
}}}

Copiare via scp dalla directory `utilities/smoothwall` di SchoolMesh, il file dello script da eseguire all'avvio e quello di configurazione nelle apposite directory, appena create.

Modificare il file di configurazione `/etc/schoolmesh/schoolmesh_iptables.rc` indicando gli indirizzi IP da cui accettare sempre le connessioni, nonché la regola di default da seguire per i casi di connessione bloccata.

{{{
#/bin/bash

#/etc/schoolmesh/schoolmesh_iptables

ALWAYS_ACCEPTED="192.168.0.121 192.168.1.105 192.168.0.122 192.168.0.123"

DEFAULT_RULE=ACCEPT
# This should be normally set to REJECT or DROP; 
# set to ACCEPT to make experiments

CHAIN=schoolmesh
}}}

== Esecuzione automatica dello script all'avvio della macchina ==

Per fare in modo che il comando descritto precedentemente venga eseguito all'avvio della macchina SmoothWall, aggiungere la riga

{{{
/root/schoolmesh/schoolmesh_iptables
}}}

alla fine del file `/etc/rc.d/rc.sysinit` (ovviamente il percorso da indicare dovrà corrispondere a quello dello script predisposto).

