#summary Configurazione di MySQL server
#labels Phase-Deploy

= MySQL =

1. Accertarsi che il server MySQL sia in funzione:

<code language="sh">
sudo service mysql status
</code>

2. Creare, con l'interfaccia preferita (ad esempio con phpMyAdmin), un utente `schoolmesh` e un database `schoolmesh_prod`:

Dovrebbero essere sufficienti i seguenti comandi SQL (ovviamente va sostituita la password):

{{{
CREATE USER 'schoolmesh'@'localhost' IDENTIFIED BY  'SuPeRsEcReT';

GRANT USAGE ON * . * TO  'schoolmesh'@'localhost' IDENTIFIED BY  'SuPeRsEcReT' WITH MAX_QUERIES_PER_HOUR 0 MAX_CONNECTIONS_PER_HOUR 0 MAX_UPDATES_PER_HOUR 0 MAX_USER_CONNECTIONS 0 ;

GRANT ALL PRIVILEGES ON  `schoolmesh\_%` . * TO  'schoolmesh'@'localhost';

CREATE DATABASE  `schoolmesh_prod` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;

}}}

3. Modificare il file _config/databases.yml_ impostando la password scelta per l'utente _schoolmesh_:

{{{
dev:
  propel:
    param:
      classname: DebugPDO
test:
  propel:
    class: sfPropelDatabase
    param:
      classname: DebugPDO
      dsn: 'mysql:host=localhost;dbname=schoolmesh_test'
prod:
  propel:
    class: sfPropelDatabase
    param:
      dsn: 'mysql:host=localhost;dbname=schoolmesh_prod'
all:
  propel:
    class: sfPropelDatabase
    param:
      dsn: 'mysql:dbname=schoolmesh;host=localhost'
      username: schoolmesh
      password: SuPeRsEcReT
      encoding: utf8
      persistent: true
      pooling: true
      classname: PropelPDO
}}}

4. Creare la struttura dei database:

<code language="sh">
cd /var/schoolmesh
schoolmesh_application_createtables prod
</code>

5. Caricare i dati del demo nel database:

<code language="sh">
cd /var/schoolmesh
wget http://www.schoolmeshdemo.tuxfamily.org/schoolmeshbase.sql.gz -O /tmp/schoolmesh/schoolmeshbase.sql.gz
schoolmesh_application_importtables prod /tmp/schoolmeshbase.sql.gz
</code>

6. Accedere con un browser alla pagina http://localhost/index.php e provare a fare il login con le credenziali indicate nella pagina http://www.schoolmesh.mattiussilab.net/demo

