#summary Configurazione di Apache
#labels Phase-Deploy

= Configurazione di Apache =

Qui di seguito viene dato per scontato che la directory in cui risiede il software sia _var/schoolmesh_. Se si installa il software altrove, andranno modificate di conseguenza le istruzioni.

Diamo per scontato che si voglia avere un file di configurazione specifico per _schoolmesh_. Ovviamente ognuno potrà personalizzare le cose come crede.

1. Scaricare il file _schoolmesh_, aggiungerlo ai file di configurazione del server web e riavviare lo stesso:

<code language="sh">
wget http://schoolmesh.googlecode.com/svn/trunk/utilities/ubuntu10.04LTS/apache2/schoolmesh -O /tmp/schoolmesh
sudo mv /tmp/schoolmesh /etc/apache2/sites-available
sudo chown root:root /etc/apache2/sites-available/schoolmesh
sudo chmod 644 /etc/apache2/sites-available/schoolmesh
sudo a2ensite schoolmesh
sudo service apache2 restart
</code>

2. Se il percorso scelto per l'applicazione non è _/schoolmesh_, modificare la riga del file _web/.htaccess_ contenente la riga relativa alla _!RewriteRule_:

{{{
  RewriteRule ^(.*)$ /schoolmesh/index.php [QSA,L]
}}} 

3. Modificare i file di configurazione di PHP (_/etc/php5/apache2/php.ini_ e _/etc/php5/cli/php.ini_) in modo che contengano le seguenti impostazioni:

{{{
short_open_tag = Off
}}}

Comando:

{{{
sudo vi /etc/php5/apache2/php.ini
sudo vi /etc/php5/cli/php.ini
}}}

4. Riavviare il server apache.

Comando:

{{{
sudo service apache2 restart
}}}

5. Se lo si desidera, configurare _sudo_ in modo che l'utente _www-data_ abbia la delega per interrogare il sistema sugli utenti e le loro directory.

Il file _/etc/sudoers_ (da modificare con `sudo visudo`, non direttamente!) dovrebbe contenere le seguenti voci:

{{{
# User alias specification
User_Alias WEBSERVER=www-data

# Cmnd alias specification
Cmnd_Alias SCHOOLMESH_INFO = /usr/bin/stat, /usr/bin/lsattr, /usr/bin/getfacl, /usr/bin/quota, /usr/bin/chage --list, /usr/bin/pdbedit -Lvu *

Cmnd_Alias SCHOOLMESH_RESETSAMBAPASSWORD = /usr/bin/smbpasswd
Cmnd_Alias SCHOOLMESH_RESETLOGINPASSWORD = /usr/sbin/chpasswd

# Cmnd_Alias SCHOOLMESH_APPLY = /usr/local/bin/schoolmesh*

# User privilege specification
root    ALL=(ALL) ALL

# Members of the admin group may gain root privileges
%admin    ALL=(ALL) ALL
WEBSERVER ALL=NOPASSWD: SCHOOLMESH_INFO, SCHOOLMESH_APPLY
}}}

Togliere il `#` sulla riga 

{{{
# Cmnd_Alias SCHOOLMESH_APPLY = /usr/local/bin/schoolmesh*
}}}

solo se si configura !SchoolMesh per l'esecuzione automatica degli script di gestione di sistema (*non raccomandabile per il momento*).

== SSL ==

(Da completare)

Abilitazione del modulo ssl di Apache:

{{{
$ sudo a2enmod ssl
Module ssl installed; run /etc/init.d/apache2 force-reload to enable.

$ sudo /etc/init.d/apache2 force-reload
 * Reloading web server config apache2                                   [ OK ] 

}}}



