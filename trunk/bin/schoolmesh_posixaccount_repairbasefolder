#!/bin/bash

CONFIG_READ=0
source /var/schoolmesh/config/schoolmesh.rc $@
if [ $CONFIG_READ -ne 1 ]; then echo "Error in reading configuration"; exit 1; fi
	
USERNAME=$1
HOMEDIR="$POSIX_HOMEDIR_USERS/$USERNAME"
BASEFOLDER="$HOMEDIR/$POSIX_BASEFOLDER"

checkUsername $USERNAME
checkDirectory "$BASEFOLDER"

sudo chattr -i "$BASEFOLDER" && sudo chown $POSIX_BASEFOLDER_OWNER "$BASEFOLDER" && sudo chattr +i "$BASEFOLDER" && echo "repaired basefolder $USERNAME ($BASEFOLDER)"  && exit 0

echo "Something wrong"
exit 99

